<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta
    name="viewport"
    content="width=device-width, initial-scale=1, viewport-fit=cover"
  />
  <title>実車評価支援ツール</title>

  <!-- PWA -->
  <link rel="manifest" href="manifest.webmanifest" />
  <meta name="theme-color" content="#0ea5e9" />

  <!-- Leaflet -->
  <link rel="stylesheet" href="leaflet.css" />

  <style>
    :root { --ui-bg:#fff; --ui-shadow: 0 6px 24px rgba(0,0,0,.18); }
    html,body,#map { height: 100%; margin: 0; }
    #map { background:#f2f2f2; }

    /* 上部パネル */
    #panel {
      position: absolute; inset: 10px auto auto 10px;
      z-index: 1000; background: var(--ui-bg);
      padding: 10px 12px; border-radius: 14px; box-shadow: var(--ui-shadow);
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans JP", sans-serif;
      min-width: 280px; max-width: min(94vw, 420px);
    }
    #panel h1 { margin: 0 0 8px; font-size: 14px; font-weight: 700; }
    .row { display: flex; gap: 8px; align-items: center; flex-wrap: wrap; margin: 6px 0; }
    label { font-size: 12px; }
    .small { font-size: 11px; color: #555; }
    .badge { display:inline-block; padding:2px 6px; background:#eef; border:1px solid #ccd; border-radius: 6px; font-size: 11px; }
    button, input[type="file"] { font: inherit; }
    button { cursor: pointer; padding: 6px 10px; border-radius: 10px; border: 1px solid #ddd; background:#fff; }
    #track { background:#16a34a; color:#fff; border-color:#16a34a; }
    #stop { background:#ef4444; color:#fff; border-color:#ef4444; }
    #recenter { background:#0ea5e9; color:#fff; border-color:#0ea5e9; }

    /* 右下のフローティング「現在地へ」 */
    #fab-recenter {
      position: absolute; right: 14px; bottom: 14px; z-index: 1000;
      width: 50px; height: 50px; border-radius: 50%;
      display:grid; place-items:center;
      background:#0ea5e9; color:#fff; box-shadow: var(--ui-shadow); border:none;
      font-size: 20px; cursor: pointer;
    }

    /* スライダー */
    input[type="range"] { width: 100%; }

    /* モバイルでパネルが邪魔な時にたたむ */
    #togglePanel {
      position:absolute; left:10px; top:10px; z-index:1001;
      background:#0ea5e9; color:#fff; border:none; border-radius: 10px;
      box-shadow: var(--ui-shadow); padding:6px 10px; display:none;
    }
    @media (max-width: 640px) {
      #togglePanel { display:block; }
      #panel.compact { display: none; }
    }
  </style>
</head>
<body>
  <div id="map"></div>

  <button id="togglePanel">メニュー</button>

  <div id="panel">
    <h1>実車評価支援ツール</h1>

    <div class="row">
      <input type="file" id="file" accept=".kml,.kmz" />
      <button id="clear">クリア</button>
    </div>

    <div class="row">
      <button id="track">位置追跡を開始</button>
      <button id="stop">停止</button>
      <button id="recenter">現在地へ</button>
      <label style="display:inline-flex; align-items:center; gap:6px;">
        <input type="checkbox" id="follow" checked /> 自動追従
      </label>
    </div>

    <div class="row">
      <label>通知距離: <span id="thv" class="badge">100m</span></label>
      <input id="th" type="range" min="20" max="300" value="100" />
    </div>

    <div class="row">
      <button id="tts">音声テスト</button>
      <span class="small" id="stat"></span>
    </div>

    <div class="small">
      ※ オンライン時に表示した地図は自動的に端末へキャッシュされ、圏外でも表示されます。
    </div>
  </div>

  <!-- 右下のフローティング現
